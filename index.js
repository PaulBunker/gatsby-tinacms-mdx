!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("tinacms"),require("react"),require("js-yaml"),require("@tinacms/form-builder")):"function"==typeof define&&define.amd?define(["exports","tinacms","react","js-yaml","@tinacms/form-builder"],t):t((e=e||self)["gatsby-tinacms-mdx"]={},e.tinacms,e.React,e.yaml,e.formBuilder)}(this,function(e,v,w,t,i){"use strict";var x=function(){return(x=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function u(a,i,u,l){return new(u=u||Promise)(function(e,t){function n(e){try{o(l.next(e))}catch(e){t(e)}}function r(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new u(function(e){e(t.value)}).then(n,r)}o((l=l.apply(a,i||[])).next())})}function l(n,r){var o,a,i,e,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,a&&(i=2&t[0]?a.return:t[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,t[1])).done)return i;switch(a=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return u.label++,{value:t[1],done:!1};case 5:u.label++,a=t[1],t=[0];continue;case 7:t=u.ops.pop(),u.trys.pop();continue;default:if(!(i=0<(i=u.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){u=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){u.label=t[1];break}if(6===t[0]&&u.label<i[1]){u.label=i[1],i=t;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(t);break}i[2]&&u.ops.pop(),u.trys.pop();continue}t=r.call(n,u)}catch(e){t=[6,e],a=0}finally{o=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}var b="useMdxForm(mdx) Required attribute `fileRelativePath` was not found on `mdx` node.\n\n1. Check if the `...TinaMdx` fragment is included in the mdx GraphQL query. For example:\n\nexport const pageQuery = graphql`\n  query BlogPostBySlug($slug: String!) {\n    mdx(fields: { slug: { eq: $slug } }) {\n      ...TinaMdx\n      // etc...\n    }\n }\n`\n  ",M="useMdxForm(mdx) Required attribute `rawMarkdownBody` was not found on `mdx` node.\n\n1. Check if the `...TinaMdx` fragment is included in the mdx GraphQL query. For example:\n\nexport const pageQuery = graphql`\n  query BlogPostBySlug($slug: String!) {\n    mdx(fields: { slug: { eq: $slug } }) {\n      ...TinaMdx\n      // etc...\n    }\n }\n`\n  ",q="useMdxForm(mdx) Required attribute `rawFrontmatter` was not found on `mdx` node.\n\n1. Check if the `...TinaMdx` fragment is included in the mdx GraphQL query. For example:\n\nexport const pageQuery = graphql`\n  query BlogPostBySlug($slug: String!) {\n    mdx(fields: { slug: { eq: $slug } }) {\n      rawFrontmatter\n      // etc...\n    }\n }\n`\n  ";function F(e){return"---\n"+t.dump(e.rawFrontmatter)+"---\n"+(e.rawMarkdownBody||"")}function P(e){return function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,u=a.length;i<u;i++,o++)r[o]=a[i];return r}(Object.keys(e.rawFrontmatter).map(function(e){return{component:"text",name:"rawFrontmatter."+e}}),[{component:"markdown",name:"rawMarkdownBody"}])}var B=require("gray-matter");function a(e,t){void 0===t&&(t={});var n,r,o,a,i=(n=e,r=w.useState(n),o=r[0],a=r[1],w.useEffect(function(){a(n||o)},[n]),o);if(!i||"production"===process.env.NODE_ENV)return[i,null];!function(e){if(void 0===e.fileRelativePath)throw new Error(b);if(void 0===e.rawFrontmatter)throw new Error(q);if(void 0===e.rawMarkdownBody)throw new Error(M)}(i);var u=v.useCMS(),l=t.label||i.frontmatter.title,s=i.fileRelativePath,c=t.actions,f=w.useMemo(function(){return{fileRelativePath:i.fileRelativePath,frontmatter:i.frontmatter,rawMarkdownBody:i.rawMarkdownBody,rawFrontmatter:JSON.parse(i.rawFrontmatter)}},[i.rawFrontmatter,i.rawMarkdownBody]),d=w.useState(),m=d[0],h=d[1];w.useEffect(function(){u.api.git.show(s).then(function(e){var t=B(e.content),n=t.content,r=t.data;h(x(x({},f),{rawFrontmatter:r,rawMarkdownBody:n}))}).catch(function(e){console.log("FAILED",e)})},[s]);var p=w.useMemo(function(){var e=t.fields||P(f);return e=e.map(function(e){return"frontmatter"===e.name||e.name.startsWith("frontmatter.")?x(x({},e),{name:e.name.replace("frontmatter","rawFrontmatter")}):e})},[t.fields]),y=v.useForm({label:l,id:s,initialValues:m,fields:p,onSubmit:function(e){return u.api.git.onSubmit({files:[e.fileRelativePath],message:e.__commit_message||"Tina commit",name:e.__commit_name,email:e.__commit_email})},reset:function(){return u.api.git.reset({files:[s]})},actions:c},{label:l,fields:p,values:f})[1],g=w.useCallback(function(e){u.api.git.onChange({fileRelativePath:e.values.fileRelativePath,content:F(e.values)})},[]);return v.useWatchFormValues(y,g),[i,y]}function s(e,t){void 0===t&&(t={});var n=a(e,t),r=n[0],o=n[1];return v.usePlugins(o),[r,o]}function o(e,t){void 0===t&&(t={});var n=a(e,t),r=n[0],o=n[1];return v.usePlugins(w.useMemo(function(){if(o)return new v.GlobalFormPlugin(o,null)},[o])),[r,o]}function c(e,t){void 0===t&&(t="mdx");var n,r=e[t];if(!r)throw"useMdxForm(mdx) '"+(n=t)+"' was not found on the top node of the graphql query\n\n1. Check if the '"+n+"' attribute is included in the GraphQL query. For example:\n\nexport const pageQuery = graphql`\n  query BlogPostBySlug($slug: String!) {\n    mdx(fields: { slug: { eq: $slug } }) {\n      ...TinaMdx\n      // etc...\n    }\n }\n\n2. If you are using an alias, For example:\n\n   export const pageQuery = graphql`\n     query BlogPostBySlug($slug: String!) {\n       "+n+": mdx(fields: { slug: { eq: $slug } }) {\n          ...TinaMdx\n       // etc...\n       }\n    }\n\n  then you can optionally use the 'queryName' option to specify a new property in place of 'mdx':\n\n    export const mdxForm(BlogPostTemplate, { queryName: "+n+" })\n`\n  ";return r}var n="createMdxButton must be given `filename(form): string`",r="createMdxButton must be given `fields: Field[]` with at least 1 item";var f=(d.prototype.onSubmit=function(o,a){return u(this,void 0,void 0,function(){var t,n,r;return l(this,function(e){switch(e.label){case 0:return[4,this.filename(o)];case 1:return t=e.sent(),[4,this.frontmatter(o)];case 2:return n=e.sent(),[4,this.body(o)];case 3:return r=e.sent(),a.api.git.onChange({fileRelativePath:t,content:F({fileRelativePath:t,rawFrontmatter:n,rawMarkdownBody:r})}),[2]}})})},d);function d(e){if(this.__type="content-creator",!e.filename)throw console.error(n),new Error(n);if(!e.fields||0===e.fields.length)throw console.error(r),new Error(r);this.name=e.label,this.fields=e.fields,this.filename=e.filename,this.frontmatter=e.frontmatter||function(){return{}},this.body=e.body||function(){return""}}e.DeleteAction=function(e){var t=this,n=e.form,r=v.useCMS();return w.createElement(v.ActionButton,{onClick:function(){return u(t,void 0,void 0,function(){return l(this,function(e){switch(e.label){case 0:return confirm("Are you sure you want to delete "+n.values.fileRelativePath+"?")?[4,r.api.git.onDelete({relPath:n.values.fileRelativePath})]:[2];case 1:return e.sent(),window.history.back(),[2]}})})}},"Delete")},e.MdxCreatorPlugin=f,e.MdxForm=function(e){var t=e._mdx,n=e.render,r=s(t,function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(e,["_mdx","render"])),o=r[0];return n({form:r[1],mdx:o})},e.createMdxButton=function(e){return new f(e)},e.globalMdx=function(n,r){return void 0===r&&(r={}),function(e){var t=o(c(e.data,r.queryName),r)[0];return w.createElement(n,x({},e,{data:x(x({},e.data),{mdx:t})}))}},e.liveMdx=function(o,a){return void 0===a&&(a={}),function(t){var e=s(c(t.data,a.queryName),a),n=e[0],r=e[1];return w.createElement(i.TinaForm,{form:r},function(e){return w.createElement(o,x({},t,{data:x(x({},t.data),{mdx:n})},e,{form:r}))})}},e.mdx=function(n,r){return void 0===r&&(r={}),function(e){var t=s(c(e.data,r.queryName),r)[0];return w.createElement(n,x({},e,{data:x(x({},e.data),{mdx:t})}))}},e.useGlobalMdx=o,e.useLocalMdx=s,e.useMdxForm=a,Object.defineProperty(e,"__esModule",{value:!0})});
